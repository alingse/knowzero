# 基础版知识图谱 (Knowledge Graph) 规划文档

> 知识图谱通过视觉化方式展示文档与实体间的关联，是 KnowZero “知识网络”愿景的直观呈现。

---

## 1. 核心目标
- **可视化关联**：直观展示文档、实体词之间的多对多关系。
- **全局导航**：点击图谱节点可快速跳转到对应文档或实体详情。
- **进度感知**：通过节点的颜色、大小反映用户的学习进度或知识点的权重。

---

## 2. 依赖项与前置实现 (Dependencies)

在实现图谱 UI 之前，后端必须支持以下关系数据的提取与存储：

### 2.1 关系模型增强
需要确保 `entity_document_links` 表中准确记录了三种关系：
1. **Explains (解释)**：文档 A 是专门为了解释实体 E 而生成的（核心节点）。
2. **Mentions (提及)**：文档 B 中提到了实体 E（弱关联）。
3. **Prerequisite (前置)**：文档 C 是学习文档 D 的前置要求（文档间关联）。

### 2.2 数据接口需求
`GET /api/sessions/{session_id}/graph`
- **返回结构 (Force-Directed Graph 格式)**：
  ```json
  {
    "nodes": [
      { "id": "doc_1", "label": "React 入门", "type": "document", "group": 1 },
      { "id": "ent_useState", "label": "useState", "type": "entity", "group": 2 }
    ],
    "links": [
      { "source": "doc_1", "target": "ent_useState", "value": 1, "relation": "mentions" }
    ]
  }
  ```

---

## 3. 技术选型 (Tech Stack)

| 组件 | 推荐方案 | 理由 |
|------|----------|------|
| **绘图引擎** | `react-force-graph-2d` | 性能优秀，开箱即用，支持 D3 动画，易于 React 集成。 |
| **布局算法** | D3 Force Layout | 自动避让，节点分布均匀，具有生命力。 |
| **交互处理** | Zustand | 用于在图谱点击时同步 `currentDocumentId` 到主界面。 |

---

## 4. 实施阶段 (Phases)

### Phase 1: 关系数据聚合 (后端)
- 实现 `graph_service.py`，负责从 `documents` 和 `entities` 表中提取当前会话的所有节点和连线。
- 逻辑：节点 = 所有 Document + 所有 Entity；连线 = `entity_document_links` + 逻辑推断的文档间关系。

### Phase 2: 基础展示 (前端)
- 在侧边栏下方或主界面切换按钮中增加“知识图谱”入口。
- 实现 `GraphView` 组件，渲染基础的力导向图。
- 节点区分：文档节点用实色圆圈，实体节点用空心或不同颜色的圆圈。

### Phase 3: 深度交互
- **双向联动**：点击图谱节点，主文档区跳转；在主文档区阅读时，图谱中对应节点高亮。
- **动态更新**：当 AI 生成新文档时，图谱通过动画效果长出新节点。
- **缩放与定位**：支持滚轮缩放、拖拽查看全局。

---

## 5. 交互设计要点 (UX Tips)

1. **节点大小**：文档节点略大于实体词节点。
2. **颜色分类**：
   - 蓝色：已阅读/生成的文档。
   - 灰色：仅提及但未深入探索的实体。
   - 黄色：当前正在阅读的节点。
3. **Tooltip**：鼠标悬浮在节点上时，显示该文档的摘要或实体的定义。

---

## 6. 未来扩展 (Future Vibe)
- **3D 视图**：在后期引入 `react-force-graph-3d`，提供沉浸式的知识太空感。
- **时间轴回溯**：按生成顺序回放图谱的生长过程。

---
*知识图谱规划 v1.0 | KnowZero 项目*
